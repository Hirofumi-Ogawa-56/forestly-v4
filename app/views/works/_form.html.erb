<!-- app/views/works/_form.html.erb -->
<div class="flex flex-col h-full bg-white overflow-y-auto px-4 sm:px-0">
  <div class="max-w-4xl mx-auto w-full pt-8 pb-12">
    <%= form_with(model: work) do |f| %>
      <%= f.fields_for :activity do |af| %>
        <%# タイトル：サイズを落とし、上下の余白をタイトに %>
        <div class="mb-4">
          <%= af.text_field :title, placeholder: "無題のドキュメント", 
              class: "w-full border-none focus:ring-0 text-3xl font-bold placeholder-gray-200 p-0 bg-transparent" %>
        </div>

        <%# メタ設定：高さを抑えたコンパクトな 1 行レイアウト %>
        <div class="flex flex-wrap items-center gap-4 py-2 px-3 mb-8 bg-gray-50/50 border border-gray-100 rounded-lg">
          
          <%# 公開範囲（x-dataは既存のものを維持） %>
          <div x-data="{ scope: '<%= af.object.visibility_range || 'is_private' %>' }" class="flex items-center gap-2">
            <span class="text-[9px] font-black text-gray-400 uppercase tracking-tighter">公開</span>
            <% 
              options = { "is_private" => "プライベート" }
              options["is_team"] = "チーム" if @current_profile.team.present?
              options["is_chat_room"] = "ルーム"
              options["is_public"] = "パブリック"
            %>
            <%= af.select :visibility_range, options.invert, {}, 
                { "x-model": "scope", class: "bg-transparent border-none text-[11px] font-bold text-gray-600 focus:ring-0 p-0 pr-6 cursor-pointer" } %>

            <%# ルーム選択（scopeがルームの時だけ表示） %>
            <template x-if="scope === 'is_chat_room'">
              <%= af.collection_select :chat_room_id, @current_profile.chat_rooms, :id, :display_name, 
                  { prompt: "選択..." }, 
                  { class: "bg-white border-gray-200 rounded text-[10px] py-0.5 px-2 focus:ring-emerald-500" } %>
            </template>
          </div>

          <div class="h-4 w-[1px] bg-gray-200"></div>

          <%# 権限詳細：ラジオボタンをセレクトボックス化して省スペースに %>
          <div class="flex items-center gap-2">
            <span class="text-[9px] font-black text-gray-400 uppercase tracking-tighter">権限</span>
            <%= af.select :permission_type, [["閲覧のみ", "read_only"], ["編集可", "edit_only"]], {}, 
                class: "bg-transparent border-none text-[11px] font-bold text-gray-600 focus:ring-0 p-0 pr-6 cursor-pointer" %>
          </div>

          <div class="h-4 w-[1px] bg-gray-200 ml-auto"></div>

          <%# チェックボックス：さらに小さく %>
          <div class="flex gap-3">
            <label class="flex items-center gap-1 cursor-pointer group">
              <%= af.check_box :allow_comment, class: "w-3 h-3 rounded text-blue-600 border-gray-300 focus:ring-0" %>
              <span class="text-[10px] text-gray-500 group-hover:text-gray-700">コメント</span>
            </label>
            <label class="flex items-center gap-1 cursor-pointer group">
              <%= af.check_box :allow_reaction, class: "w-3 h-3 rounded text-blue-600 border-gray-300 focus:ring-0" %>
              <span class="text-[10px] text-gray-500 group-hover:text-gray-700">反応</span>
            </label>
          </div>
        </div>
      <% end %>

      <%# Note 本文：境界線を目立たせず、すぐに書き始められる印象に %>
      <div class="prose prose-slate max-w-none min-h-[60vh]">
        <%= fields_for :note, @note do |nf| %>
          <%= nf.rich_text_area :content, placeholder: "ここから書き始める...", class: "focus:outline-none" %>
        <% end %>
      </div>

      <%# 下部アクションバー %>
      <div class="sticky bottom-6 flex justify-end gap-3 mt-12 bg-white/80 backdrop-blur py-4 border-t border-gray-50">
        <%= link_to 'キャンセル', works_path, class: "text-gray-400 px-4 py-2 text-xs font-bold hover:text-gray-600" %>
        <%= f.submit (work.persisted? ? "更新する" : "ドキュメントを保存"), 
            class: "bg-blue-600 text-white px-8 py-2 rounded-lg text-xs font-bold shadow-lg shadow-blue-100 hover:bg-blue-700 transition-all cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>